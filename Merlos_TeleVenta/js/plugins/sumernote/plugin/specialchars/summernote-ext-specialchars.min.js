!function(factory){"function"==typeof define&&define.amd?define(["jquery"],factory):"object"==typeof module&&module.exports?module.exports=factory(require("jquery")):factory(window.jQuery)}(function($){$.extend($.summernote.plugins,{specialchars:function(context){var currentColumn,currentRow,totalColumn,self=this,ui=$.summernote.ui,$editor=context.layoutInfo.editor,options=context.options,lang=options.langInfo,KEY={UP:38,DOWN:40,LEFT:37,RIGHT:39,ENTER:13},COLUMN_LENGTH=15,totalRow=0,specialCharDataSet=["&quot;","&amp;","&lt;","&gt;","&iexcl;","&cent;","&pound;","&curren;","&yen;","&brvbar;","&sect;","&uml;","&copy;","&ordf;","&laquo;","&not;","&reg;","&macr;","&deg;","&plusmn;","&sup2;","&sup3;","&acute;","&micro;","&para;","&middot;","&cedil;","&sup1;","&ordm;","&raquo;","&frac14;","&frac12;","&frac34;","&iquest;","&times;","&divide;","&fnof;","&circ;","&tilde;","&ndash;","&mdash;","&lsquo;","&rsquo;","&sbquo;","&ldquo;","&rdquo;","&bdquo;","&dagger;","&Dagger;","&bull;","&hellip;","&permil;","&prime;","&Prime;","&lsaquo;","&rsaquo;","&oline;","&frasl;","&euro;","&image;","&weierp;","&real;","&trade;","&alefsym;","&larr;","&uarr;","&rarr;","&darr;","&harr;","&crarr;","&lArr;","&uArr;","&rArr;","&dArr;","&hArr;","&forall;","&part;","&exist;","&empty;","&nabla;","&isin;","&notin;","&ni;","&prod;","&sum;","&minus;","&lowast;","&radic;","&prop;","&infin;","&ang;","&and;","&or;","&cap;","&cup;","&int;","&there4;","&sim;","&cong;","&asymp;","&ne;","&equiv;","&le;","&ge;","&sub;","&sup;","&nsub;","&sube;","&supe;","&oplus;","&otimes;","&perp;","&sdot;","&lceil;","&rceil;","&lfloor;","&rfloor;","&loz;","&spades;","&clubs;","&hearts;","&diams;"];context.memo("button.specialCharacter",function(){return ui.button({contents:'<i class="fa fa-font fa-flip-vertical">',tooltip:lang.specialChar.specialChar,click:function(){self.show()}}).render()}),this.makeSpecialCharSetTable=function(){var $table=$("<table/>");return $.each(specialCharDataSet,function(idx,text){var $td=$("<td/>").addClass("note-specialchar-node"),$tr=idx%COLUMN_LENGTH==0?$("<tr/>"):$table.find("tr").last(),$button=ui.button({callback:function($node){$node.html(text),$node.attr("title",text),$node.attr("data-value",encodeURIComponent(text)),$node.css({width:35,"margin-right":"2px","margin-bottom":"2px"})}}).render();$td.append($button),$tr.append($td),idx%COLUMN_LENGTH==0&&$table.append($tr)}),totalRow=$table.find("tr").length,totalColumn=COLUMN_LENGTH,$table},this.initialize=function(){var $container=options.dialogsInBody?$(document.body):$editor,body='<div class="form-group row-fluid">'+this.makeSpecialCharSetTable()[0].outerHTML+"</div>";this.$dialog=ui.dialog({title:lang.specialChar.select,body}).render().appendTo($container)},this.show=function(){var text=context.invoke("editor.getSelectedText");context.invoke("editor.saveRange"),this.showSpecialCharDialog(text).then(function(selectChar){context.invoke("editor.restoreRange");var $node=$("<span></span>").html(selectChar)[0];$node&&context.invoke("editor.insertNode",$node)}).fail(function(){context.invoke("editor.restoreRange")})},this.showSpecialCharDialog=function(text){return $.Deferred(function(deferred){var $specialCharDialog=self.$dialog,$specialCharNode=$specialCharDialog.find(".note-specialchar-node"),$selectedNode=null,ARROW_KEYS=[KEY.UP,KEY.DOWN,KEY.LEFT,KEY.RIGHT],ENTER_KEY=KEY.ENTER;function addActiveClass($target){$target&&($target.find("button").addClass("active"),$selectedNode=$target)}function removeActiveClass($target){$target.find("button").removeClass("active"),$selectedNode=null}function arrowKeyHandler(keyCode){var $nextNode,row,column,findNode,lastRowColumnLength=$specialCharNode.length%totalColumn;KEY.LEFT===keyCode?currentColumn>1?currentColumn-=1:1===currentRow&&1===currentColumn?(currentColumn=lastRowColumnLength,currentRow=totalRow):(currentColumn=totalColumn,currentRow-=1):KEY.RIGHT===keyCode?currentRow===totalRow&&lastRowColumnLength===currentColumn?(currentColumn=1,currentRow=1):currentColumn<totalColumn?currentColumn+=1:(currentColumn=1,currentRow+=1):KEY.UP===keyCode?1===currentRow&&lastRowColumnLength<currentColumn?currentRow=totalRow-1:currentRow-=1:KEY.DOWN===keyCode&&(currentRow+=1),currentRow===totalRow&&currentColumn>lastRowColumnLength?currentRow=1:currentRow>totalRow?currentRow=1:currentRow<1&&(currentRow=totalRow),row=currentRow,column=currentColumn,findNode=null,$.each($specialCharNode,function(idx,$node){if(Math.ceil((idx+1)/COLUMN_LENGTH)===row&&((idx+1)%COLUMN_LENGTH==0?COLUMN_LENGTH:(idx+1)%COLUMN_LENGTH)===column)return findNode=$node,!1}),($nextNode=$(findNode))&&(removeActiveClass($selectedNode),addActiveClass($nextNode))}function keyDownEventHandler(event){event.preventDefault();var keyCode=event.keyCode;if(null!=keyCode){if(ARROW_KEYS.indexOf(keyCode)>-1){if(null===$selectedNode)return addActiveClass($specialCharNode.eq(0)),currentColumn=1,void(currentRow=1);arrowKeyHandler(keyCode)}else keyCode===ENTER_KEY&&$selectedNode&&(deferred.resolve(decodeURIComponent($selectedNode.find("button").attr("data-value"))),$specialCharDialog.modal("hide"));return!1}}if(removeActiveClass($specialCharNode),text)for(var i=0;i<$specialCharNode.length;i++){var $checkNode=$($specialCharNode[i]);$checkNode.text()===text&&(addActiveClass($checkNode),currentRow=Math.ceil((i+1)/COLUMN_LENGTH),currentColumn=(i+1)%COLUMN_LENGTH)}ui.onDialogShown(self.$dialog,function(){$(document).on("keydown",keyDownEventHandler),self.$dialog.find("button").tooltip(),$specialCharNode.on("click",function(event){event.preventDefault(),deferred.resolve(decodeURIComponent($(event.currentTarget).find("button").attr("data-value"))),ui.hideDialog(self.$dialog)})}),ui.onDialogHidden(self.$dialog,function(){$specialCharNode.off("click"),self.$dialog.find("button").tooltip("destroy"),$(document).off("keydown",keyDownEventHandler),"pending"===deferred.state()&&deferred.reject()}),ui.showDialog(self.$dialog)})}}})});