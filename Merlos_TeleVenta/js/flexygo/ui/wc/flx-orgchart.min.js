var flexygo;!function(flexygo){!function(ui){!function(wc){wc.FlxOrgChartElement=class extends HTMLElement{constructor(){super(),this.objectname=null,this.objectwhere=null,this.data=null,this.tHeader=null,this.tBody=null,this.tFooter=null,this.moduleName=null,this.tree=null,this.options=null,this.stackChildren=!0,this.connected=!1}connectedCallback(){let element=$(this);this.moduleName=element.attr("modulename"),this.connected=!0,this.moduleName&&"true"!=element.attr("manualInit")&&this.init()}static get observedAttributes(){return["modulename","objectname","objectwhere"]}attributeChangedCallback(attrName,oldVal,newVal){let isDirty=!1;this.connected&&("modulename"==attrName.toLowerCase()&&newVal&&""!=newVal&&(this.moduleName=newVal,this.moduleName&&(isDirty=!0)),this&&"objectname"==attrName.toLowerCase()&&newVal&&""!=newVal&&(this.objectname=newVal,this.objectname&&(isDirty=!0)),this&&"objectwhere"==attrName.toLowerCase()&&newVal&&""!=newVal&&(this.objectwhere=newVal,this.objectwhere&&(isDirty=!0)),!0===this.connected&&!0===isDirty&&this.refresh())}refresh(){"true"!=$(this).attr("manualInit")&&this.init()}init(){let me=$(this);if(me.removeAttr("manualInit"),me.empty(),this.options={chart:{connectors:{type:"step"},node:{HTMLclass:"orgchartnode"},hideRootNode:!0,animteOnInit:!0}},this.moduleName){let params={ObjectName:this.objectname,ObjectWhere:this.objectwhere,ModuleName:this.moduleName,PageName:flexygo.history.getPageName(me)};flexygo.ajax.post("~/api/OrgChart","GetNodes",params,response=>{response?(this.tHeader=response.Template.Header,this.tFooter=response.Template.Footer,this.tBody=response.Template.Body,this.data=response.Template.TableData,flexygo.utils.isBlank(response.Options)||(this.options=response.Options),this.render()):this.stopLoading()},error=>{flexygo.exceptions.httpShow(error),this.stopLoading()},null,()=>{this.startLoading()})}}render(){let me=$(this),parentModule=me.closest("flx-module"),wcModule=parentModule[0],rendered="";if(this.data.length>0){this.tHeader&&""!==this.tHeader&&(rendered+=flexygo.utils.parser.recursiveCompile(this.data[0],this.tHeader,this));let uniqueId=flexygo.utils.uniqueId();rendered+='<div class="flx-orgchart" id="'+uniqueId+'"></div>',this.tFooter&&""!==this.tFooter&&(rendered+=flexygo.utils.parser.recursiveCompile(this.data[0],this.tFooter,this)),me.html(rendered);let initialNode=new flexygo.api.orgchart.Node;if(initialNode.children=new Array,this.tBody&&""!==this.tBody)for(let i=0;i<this.data.length;i++)if(flexygo.utils.isBlank(this.data[i].Parent)){let node=new flexygo.api.orgchart.Node;node.id=this.data[i].Id,node.innerHTML=flexygo.utils.parser.recursiveCompile(this.data[i],this.tBody,this),node.children=this.getChildren(this.data[i].Id),node.stackChildren=this.stackChildren,initialNode.children.push(node)}this.options.chart.container="#"+uniqueId,this.options.chart.callback={onTreeLoaded:()=>{this.stopLoading()}},this.options.nodeStructure=initialNode,this.tree=new Treant(this.options)}parentModule&&wcModule&&wcModule.moduleLoaded(this)}getChildren(id){let children=new Array;for(let i=0;i<this.data.length;i++)if(this.data[i].Parent==id){let node=new flexygo.api.orgchart.Node;node.id=this.data[i].Id,node.innerHTML=flexygo.utils.parser.recursiveCompile(this.data[i],this.tBody,this),node.children=this.getChildren(this.data[i].Id),node.stackChildren=this.stackChildren,node.collapsable=!0,children.push(node)}return children.length>0?children:null}translate(str){return flexygo.localization.translate(str)}startLoading(){$(this).parents("flx-module").length>0&&$(this).parents("flx-module")[0].startLoading()}stopLoading(){$(this).parents("flx-module").length>0&&$(this).parents("flx-module")[0].stopLoading()}}}(ui.wc||(ui.wc={}))}(flexygo.ui||(flexygo.ui={}))}(flexygo||(flexygo={})),window.customElements.define("flx-orgchart",flexygo.ui.wc.FlxOrgChartElement);