!function(){String.prototype.startsWith||(String.prototype.startsWith=function(searchString,position){return this.substr(position||0,searchString.length)===searchString});var $=null,UTIL={inheritAttrs:function(applyTo,applyFrom){for(var attr in applyFrom)applyFrom.hasOwnProperty(attr)&&(applyTo[attr]instanceof Object&&applyFrom[attr]instanceof Object&&"function"!=typeof applyFrom[attr]?this.inheritAttrs(applyTo[attr],applyFrom[attr]):applyTo[attr]=applyFrom[attr]);return applyTo},createMerge:function(obj1,obj2){var newObj={};return obj1&&this.inheritAttrs(newObj,this.cloneObj(obj1)),obj2&&this.inheritAttrs(newObj,obj2),newObj},extend:function(){return $?(Array.prototype.unshift.apply(arguments,[!0,{}]),$.extend.apply($,arguments)):UTIL.createMerge.apply(this,arguments)},cloneObj:function(obj){if(Object(obj)!==obj)return obj;var res=new obj.constructor;for(var key in obj)obj.hasOwnProperty(key)&&(res[key]=this.cloneObj(obj[key]));return res},addEvent:function(el,eventType,handler){$?$(el).on(eventType+".treant",handler):el.addEventListener?el.addEventListener(eventType,handler,!1):el.attachEvent?el.attachEvent("on"+eventType,handler):el["on"+eventType]=handler},findEl:function(selector,raw,parentEl){if(parentEl=parentEl||document,$){var $element=$(selector,parentEl);return raw?$element.get(0):$element}if("#"===selector.charAt(0))return parentEl.getElementById(selector.substring(1));if("."===selector.charAt(0)){var oElements=parentEl.getElementsByClassName(selector.substring(1));return oElements.length?oElements[0]:null}throw new Error("Unknown container element")},getOuterHeight:function(element){return"function"==typeof element.getBoundingClientRect?element.getBoundingClientRect().height:$?Math.ceil($(element).outerHeight())+1:Math.ceil(element.clientHeight+UTIL.getStyle(element,"border-top-width",!0)+UTIL.getStyle(element,"border-bottom-width",!0)+UTIL.getStyle(element,"padding-top",!0)+UTIL.getStyle(element,"padding-bottom",!0)+1)},getOuterWidth:function(element){return"function"==typeof element.getBoundingClientRect?element.getBoundingClientRect().width:$?Math.ceil($(element).outerWidth())+1:Math.ceil(element.clientWidth+UTIL.getStyle(element,"border-left-width",!0)+UTIL.getStyle(element,"border-right-width",!0)+UTIL.getStyle(element,"padding-left",!0)+UTIL.getStyle(element,"padding-right",!0)+1)},getStyle:function(element,strCssRule,asInt){var strValue="";return document.defaultView&&document.defaultView.getComputedStyle?strValue=document.defaultView.getComputedStyle(element,"").getPropertyValue(strCssRule):element.currentStyle&&(strCssRule=strCssRule.replace(/\-(\w)/g,function(strMatch,p1){return p1.toUpperCase()}),strValue=element.currentStyle[strCssRule]),asInt?parseFloat(strValue):strValue},addClass:function(element,cssClass){$?$(element).addClass(cssClass):UTIL.hasClass(element,cssClass)||(element.classList?element.classList.add(cssClass):element.className+=" "+cssClass)},hasClass:function(element,my_class){return(" "+element.className+" ").replace(/[\n\t]/g," ").indexOf(" "+my_class+" ")>-1},toggleClass:function(element,cls,apply){$?$(element).toggleClass(cls,apply):apply?element.classList.add(cls):element.classList.remove(cls)},setDimensions:function(element,width,height){$?$(element).width(width).height(height):(element.style.width=width+"px",element.style.height=height+"px")},isjQueryAvailable:function(){return void 0!==$&&$}},ImageLoader=function(){this.reset()};ImageLoader.prototype={reset:function(){return this.loading=[],this},processNode:function(node){for(var aImages=node.nodeDOM.getElementsByTagName("img"),i=aImages.length;i--;)this.create(node,aImages[i]);return this},removeAll:function(img_src){for(var i=this.loading.length;i--;)this.loading[i]===img_src&&this.loading.splice(i,1);return this},create:function(node,image){var self=this,source=image.src;function imgTrigger(){self.removeAll(source),node.width=node.nodeDOM.offsetWidth,node.height=node.nodeDOM.offsetHeight}if(0!==image.src.indexOf("data:")){if(this.loading.push(source),image.complete)return imgTrigger();UTIL.addEvent(image,"load",imgTrigger),UTIL.addEvent(image,"error",imgTrigger),image.src+=(image.src.indexOf("?")>0?"&":"?")+(new Date).getTime()}else imgTrigger()},isNotLoading:function(){return 0===this.loading.length}};var TreeStore={store:[],createTree:function(jsonConfig){var nNewTreeId=this.store.length;return this.store.push(new Tree(jsonConfig,nNewTreeId)),this.get(nNewTreeId)},get:function(treeId){return this.store[treeId]},destroy:function(treeId){var tree=this.get(treeId);if(tree){tree._R.remove();for(var draw_area=tree.drawArea;draw_area.firstChild;)draw_area.removeChild(draw_area.firstChild);for(var classes=draw_area.className.split(" "),classes_to_stay=[],i=0;i<classes.length;i++){var cls=classes[i];"Treant"!==cls&&"Treant-loaded"!==cls&&classes_to_stay.push(cls)}draw_area.style.overflowY="",draw_area.style.overflowX="",draw_area.className=classes_to_stay.join(" "),this.store[treeId]=null}return this}},Tree=function(jsonConfig,treeId){this.reset=function(jsonConfig,treeId){if(this.initJsonConfig=jsonConfig,this.initTreeId=treeId,this.id=treeId,this.CONFIG=UTIL.extend(Tree.CONFIG,jsonConfig.chart),this.drawArea=UTIL.findEl(this.CONFIG.container,!0),!this.drawArea)throw new Error('Failed to find element by selector "'+this.CONFIG.container+'"');return UTIL.addClass(this.drawArea,"Treant"),this.drawArea.innerHTML="",this.imageLoader=new ImageLoader,this.nodeDB=new NodeDB(jsonConfig.nodeStructure,this),this.connectionStore={},this.loaded=!1,this._R=new Raphael(this.drawArea,100,100),this},this.reload=function(){return this.reset(this.initJsonConfig,this.initTreeId).redraw(),this},this.reset(jsonConfig,treeId)};Tree.prototype={getNodeDb:function(){return this.nodeDB},addNode:function(parentTreeNode,nodeDefinition){this.nodeDB.get(parentTreeNode.id);this.CONFIG.callback.onBeforeAddNode.apply(this,[parentTreeNode,nodeDefinition]);var oNewNode=this.nodeDB.createNode(nodeDefinition,parentTreeNode.id,this);return oNewNode.createGeometry(this),oNewNode.parent().createSwitchGeometry(this),this.positionTree(),this.CONFIG.callback.onAfterAddNode.apply(this,[oNewNode,parentTreeNode,nodeDefinition]),oNewNode},redraw:function(){return this.positionTree(),this},positionTree:function(callback){var self=this;if(this.imageLoader.isNotLoading()){var root=this.root();this.CONFIG.rootOrientation;this.resetLevelData(),this.firstWalk(root,0),this.secondWalk(root,0,0,0),this.positionNodes(),this.CONFIG.animateOnInit&&setTimeout(function(){root.toggleCollapse()},this.CONFIG.animateOnInitDelay),this.loaded||(UTIL.addClass(this.drawArea,"Treant-loaded"),"[object Function]"===Object.prototype.toString.call(callback)&&callback(self),self.CONFIG.callback.onTreeLoaded.apply(self,[root]),this.loaded=!0)}else setTimeout(function(){self.positionTree(callback)},10);return this},firstWalk:function(node,level){node.prelim=null,node.modifier=null,this.setNeighbors(node,level),this.calcLevelDim(node,level);var leftSibling=node.leftSibling();if(0===node.childrenCount()||level==this.CONFIG.maxDepth)node.prelim=leftSibling?leftSibling.prelim+leftSibling.size()+this.CONFIG.siblingSeparation:0;else{for(var i=0,n=node.childrenCount();i<n;i++)this.firstWalk(node.childAt(i),level+1);var midPoint=node.childrenCenter()-node.size()/2;leftSibling?(node.prelim=leftSibling.prelim+leftSibling.size()+this.CONFIG.siblingSeparation,node.modifier=node.prelim-midPoint,this.apportion(node,level)):node.prelim=midPoint,node.stackParent?node.modifier+=this.nodeDB.get(node.stackChildren[0]).size()/2+node.connStyle.stackIndent:node.stackParentId&&(node.prelim=0)}return this},apportion:function(node,level){for(var firstChild=node.firstChild(),firstChildLeftNeighbor=firstChild.leftNeighbor(),compareDepth=1,depthToStop=this.CONFIG.maxDepth-level;firstChild&&firstChildLeftNeighbor&&compareDepth<=depthToStop;){for(var modifierSumRight=0,modifierSumLeft=0,leftAncestor=firstChildLeftNeighbor,rightAncestor=firstChild,i=0;i<compareDepth;i++)leftAncestor=leftAncestor.parent(),rightAncestor=rightAncestor.parent(),modifierSumLeft+=leftAncestor.modifier,modifierSumRight+=rightAncestor.modifier,void 0!==rightAncestor.stackParent&&(modifierSumRight+=rightAncestor.size()/2);var totalGap=firstChildLeftNeighbor.prelim+modifierSumLeft+firstChildLeftNeighbor.size()+this.CONFIG.subTeeSeparation-(firstChild.prelim+modifierSumRight);if(totalGap>0){for(var subtreeAux=node,numSubtrees=0;subtreeAux&&subtreeAux.id!==leftAncestor.id;)subtreeAux=subtreeAux.leftSibling(),numSubtrees++;if(subtreeAux)for(var subtreeMoveAux=node,singleGap=totalGap/numSubtrees;subtreeMoveAux.id!==leftAncestor.id;)subtreeMoveAux.prelim+=totalGap,subtreeMoveAux.modifier+=totalGap,totalGap-=singleGap,subtreeMoveAux=subtreeMoveAux.leftSibling()}compareDepth++,(firstChild=0===firstChild.childrenCount()?node.leftMost(0,compareDepth):firstChild=firstChild.firstChild())&&(firstChildLeftNeighbor=firstChild.leftNeighbor())}},secondWalk:function(node,level,X,Y){if(level<=this.CONFIG.maxDepth){var levelHeight,nodesizeTmp,xTmp=node.prelim+X,yTmp=Y,align=this.CONFIG.nodeAlign,orient=this.CONFIG.rootOrientation;if("NORTH"===orient||"SOUTH"===orient?(levelHeight=this.levelMaxDim[level].height,nodesizeTmp=node.height,node.pseudo&&(node.height=levelHeight)):"WEST"!==orient&&"EAST"!==orient||(levelHeight=this.levelMaxDim[level].width,nodesizeTmp=node.width,node.pseudo&&(node.width=levelHeight)),node.X=xTmp,node.pseudo?"NORTH"===orient||"WEST"===orient?node.Y=yTmp:"SOUTH"!==orient&&"EAST"!==orient||(node.Y=yTmp+(levelHeight-nodesizeTmp)):node.Y="CENTER"===align?yTmp+(levelHeight-nodesizeTmp)/2:"TOP"===align?yTmp+(levelHeight-nodesizeTmp):yTmp,"WEST"===orient||"EAST"===orient){var swapTmp=node.X;node.X=node.Y,node.Y=swapTmp}"SOUTH"===orient?node.Y=-node.Y-nodesizeTmp:"EAST"===orient&&(node.X=-node.X-nodesizeTmp),0!==node.childrenCount()&&(0===node.id&&this.CONFIG.hideRootNode?this.secondWalk(node.firstChild(),level+1,X+node.modifier,Y):this.secondWalk(node.firstChild(),level+1,X+node.modifier,Y+levelHeight+this.CONFIG.levelSeparation)),node.rightSibling()&&this.secondWalk(node.rightSibling(),level,X,Y)}},positionNodes:function(){var treeSize={x:this.nodeDB.getMinMaxCoord("X",null,null),y:this.nodeDB.getMinMaxCoord("Y",null,null)},treeWidth=treeSize.x.max-treeSize.x.min,treeHeight=treeSize.y.max-treeSize.y.min,treeCenter={x:treeSize.x.max-treeWidth/2,y:treeSize.y.max-treeHeight/2};this.handleOverflow(treeWidth,treeHeight);var i,len,node,containerCenter={x:this.drawArea.clientWidth/2,y:this.drawArea.clientHeight/2},deltaX=containerCenter.x-treeCenter.x,deltaY=containerCenter.y-treeCenter.y,negOffsetX=treeSize.x.min+deltaX<=0?Math.abs(treeSize.x.min):0,negOffsetY=treeSize.y.min+deltaY<=0?Math.abs(treeSize.y.min):0;for(i=0,len=this.nodeDB.db.length;i<len;i++)if(node=this.nodeDB.get(i),this.CONFIG.callback.onBeforePositionNode.apply(this,[node,i,containerCenter,treeCenter]),0===node.id&&this.CONFIG.hideRootNode)this.CONFIG.callback.onAfterPositionNode.apply(this,[node,i,containerCenter,treeCenter]);else{node.X+=negOffsetX+(treeWidth<this.drawArea.clientWidth?deltaX:this.CONFIG.padding),node.Y+=negOffsetY+(treeHeight<this.drawArea.clientHeight?deltaY:this.CONFIG.padding);var collapsedParent=node.collapsedParent(),hidePoint=null;collapsedParent?(hidePoint=collapsedParent.connectorPoint(!0),node.hide(hidePoint)):node.positioned?node.show():(node.nodeDOM.style.left=node.X+"px",node.nodeDOM.style.top=node.Y+"px",node.positioned=!0),0===node.id||0===node.parent().id&&this.CONFIG.hideRootNode?!this.CONFIG.hideRootNode&&node.drawLineThrough&&node.drawLineThroughMe():this.setConnectionToParent(node,hidePoint),this.CONFIG.callback.onAfterPositionNode.apply(this,[node,i,containerCenter,treeCenter])}return this},handleOverflow:function(treeWidth,treeHeight){var viewWidth=treeWidth<this.drawArea.clientWidth?this.drawArea.clientWidth:treeWidth+2*this.CONFIG.padding,viewHeight=treeHeight<this.drawArea.clientHeight?this.drawArea.clientHeight:treeHeight+2*this.CONFIG.padding;if(this._R.setSize(viewWidth,viewHeight),"resize"===this.CONFIG.scrollbar)UTIL.setDimensions(this.drawArea,viewWidth,viewHeight);else if(UTIL.isjQueryAvailable()&&"native"!==this.CONFIG.scrollbar){if("fancy"===this.CONFIG.scrollbar){var jq_drawArea=$(this.drawArea);if(jq_drawArea.hasClass("ps-container"))jq_drawArea.find(".Treant").css({width:viewWidth,height:viewHeight}),jq_drawArea.perfectScrollbar("update");else{var mainContainer=jq_drawArea.wrapInner('<div class="Treant"/>');mainContainer.find(".Treant").css({width:viewWidth,height:viewHeight}),mainContainer.perfectScrollbar()}}}else this.drawArea.clientWidth<treeWidth&&(this.drawArea.style.overflowX="auto"),this.drawArea.clientHeight<treeHeight&&(this.drawArea.style.overflowY="auto");return this},setConnectionToParent:function(treeNode,hidePoint){var connLine,stacked=treeNode.stackParentId,parent=stacked?this.nodeDB.get(stacked):treeNode.parent(),pathString=hidePoint?this.getPointPathString(hidePoint):this.getPathString(parent,treeNode,stacked);return this.connectionStore[treeNode.id]?(connLine=this.connectionStore[treeNode.id],this.animatePath(connLine,pathString)):(connLine=this._R.path(pathString),this.connectionStore[treeNode.id]=connLine,treeNode.pseudo&&delete parent.connStyle.style["arrow-end"],parent.pseudo&&delete parent.connStyle.style["arrow-start"],connLine.attr(parent.connStyle.style),(treeNode.drawLineThrough||treeNode.pseudo)&&treeNode.drawLineThroughMe(hidePoint)),treeNode.connector=connLine,this},getPointPathString:function(hidePoint){return["_M",hidePoint.x,",",hidePoint.y,"L",hidePoint.x,",",hidePoint.y,hidePoint.x,",",hidePoint.y].join(" ")},animatePath:function(path,pathString){return path.hidden&&"_"!==pathString.charAt(0)&&(path.show(),path.hidden=!1),path.animate({path:"_"===pathString.charAt(0)?pathString.substring(1):pathString},this.CONFIG.animation.connectorsSpeed,this.CONFIG.animation.connectorsAnimation,function(){"_"===pathString.charAt(0)&&(path.hide(),path.hidden=!0)}),this},getPathString:function(from_node,to_node,stacked){var startPoint=from_node.connectorPoint(!0),endPoint=to_node.connectorPoint(!1),orientation=this.CONFIG.rootOrientation,connType=from_node.connStyle.type,P1={},P2={};"NORTH"===orientation||"SOUTH"===orientation?(P1.y=P2.y=(startPoint.y+endPoint.y)/2,P1.x=startPoint.x,P2.x=endPoint.x):"EAST"!==orientation&&"WEST"!==orientation||(P1.x=P2.x=(startPoint.x+endPoint.x)/2,P1.y=startPoint.y,P2.y=endPoint.y);var pathString,stackPoint,sp=startPoint.x+","+startPoint.y,p1=P1.x+","+P1.y,p2=P2.x+","+P2.y,ep=endPoint.x+","+endPoint.y,pm=(P1.x+P2.x)/2+","+(P1.y+P2.y)/2;if(stacked){if(stackPoint="EAST"===orientation||"WEST"===orientation?endPoint.x+","+startPoint.y:startPoint.x+","+endPoint.y,"step"===connType||"straight"===connType)pathString=["M",sp,"L",stackPoint,"L",ep];else if("curve"===connType||"bCurve"===connType){var helpPoint,indent=from_node.connStyle.stackIndent;"NORTH"===orientation?helpPoint=endPoint.x-indent+","+(endPoint.y-indent):"SOUTH"===orientation?helpPoint=endPoint.x-indent+","+(endPoint.y+indent):"EAST"===orientation?helpPoint=endPoint.x+indent+","+startPoint.y:"WEST"===orientation&&(helpPoint=endPoint.x-indent+","+startPoint.y),pathString=["M",sp,"L",helpPoint,"S",stackPoint,ep]}}else"step"===connType?pathString=["M",sp,"L",p1,"L",p2,"L",ep]:"curve"===connType?pathString=["M",sp,"C",p1,p2,ep]:"bCurve"===connType?pathString=["M",sp,"Q",p1,pm,"T",ep]:"straight"===connType&&(pathString=["M",sp,"L",sp,ep]);return pathString.join(" ")},setNeighbors:function(node,level){return node.leftNeighborId=this.lastNodeOnLevel[level],node.leftNeighborId&&(node.leftNeighbor().rightNeighborId=node.id),this.lastNodeOnLevel[level]=node.id,this},calcLevelDim:function(node,level){return this.levelMaxDim[level]={width:Math.max(this.levelMaxDim[level]?this.levelMaxDim[level].width:0,node.width),height:Math.max(this.levelMaxDim[level]?this.levelMaxDim[level].height:0,node.height)},this},resetLevelData:function(){return this.lastNodeOnLevel=[],this.levelMaxDim=[],this},root:function(){return this.nodeDB.get(0)}};var NodeDB=function(nodeStructure,tree){this.reset(nodeStructure,tree)};NodeDB.prototype={reset:function(nodeStructure,tree){this.db=[];var self=this;return tree.CONFIG.animateOnInit&&(nodeStructure.collapsed=!0),function iterateChildren(node,parentId){var newNode=self.createNode(node,parentId,tree,null);if(node.children){if(node.childrenDropLevel&&node.childrenDropLevel>0)for(;node.childrenDropLevel--;){var connStyle=UTIL.cloneObj(newNode.connStyle);(newNode=self.createNode("pseudo",newNode.id,tree,null)).connStyle=connStyle,newNode.children=[]}var stack=node.stackChildren&&!self.hasGrandChildren(node)?newNode.id:null;null!==stack&&(newNode.stackChildren=[]);for(var i=0,len=node.children.length;i<len;i++)null!==stack?(newNode=self.createNode(node.children[i],newNode.id,tree,stack),i+1<len&&(newNode.children=[])):iterateChildren(node.children[i],newNode.id)}}(nodeStructure,-1),this.createGeometries(tree),this},createGeometries:function(tree){for(var i=this.db.length;i--;)this.get(i).createGeometry(tree);return this},get:function(nodeId){return this.db[nodeId]},walk:function(callback){for(var i=this.db.length;i--;)callback.apply(this,[this.get(i)]);return this},createNode:function(nodeStructure,parentId,tree,stackParentId){var node=new TreeNode(nodeStructure,this.db.length,parentId,tree,stackParentId);if(this.db.push(node),parentId>=0){var parent=this.get(parentId);if(nodeStructure.position)if("left"===nodeStructure.position)parent.children.push(node.id);else if("right"===nodeStructure.position)parent.children.splice(0,0,node.id);else if("center"===nodeStructure.position)parent.children.splice(Math.floor(parent.children.length/2),0,node.id);else{var position=parseInt(nodeStructure.position);1===parent.children.length&&position>0?parent.children.splice(0,0,node.id):parent.children.splice(Math.max(position,parent.children.length-1),0,node.id)}else parent.children.push(node.id)}return stackParentId&&(this.get(stackParentId).stackParent=!0,this.get(stackParentId).stackChildren.push(node.id)),node},getMinMaxCoord:function(dim,parent,MinMax){parent=parent||this.get(0),MinMax=MinMax||{min:parent[dim],max:parent[dim]+("X"===dim?parent.width:parent.height)};for(var i=parent.childrenCount();i--;){var node=parent.childAt(i),maxTest=node[dim]+("X"===dim?node.width:node.height),minTest=node[dim];maxTest>MinMax.max&&(MinMax.max=maxTest),minTest<MinMax.min&&(MinMax.min=minTest),this.getMinMaxCoord(dim,node,MinMax)}return MinMax},hasGrandChildren:function(nodeStructure){for(var i=nodeStructure.children.length;i--;)if(nodeStructure.children[i].children)return!0;return!1}};var TreeNode=function(nodeStructure,id,parentId,tree,stackParentId){this.reset(nodeStructure,id,parentId,tree,stackParentId)};TreeNode.prototype={reset:function(nodeStructure,id,parentId,tree,stackParentId){return this.id=id,this.parentId=parentId,this.treeId=tree.id,this.prelim=0,this.modifier=0,this.leftNeighborId=null,this.stackParentId=stackParentId,this.pseudo="pseudo"===nodeStructure||nodeStructure.pseudo,this.meta=nodeStructure.meta||{},this.image=nodeStructure.image||null,this.link=UTIL.createMerge(tree.CONFIG.node.link,nodeStructure.link),this.connStyle=UTIL.createMerge(tree.CONFIG.connectors,nodeStructure.connectors),this.connector=null,this.drawLineThrough=!1!==nodeStructure.drawLineThrough&&(nodeStructure.drawLineThrough||tree.CONFIG.node.drawLineThrough),this.collapsable=!1!==nodeStructure.collapsable&&(nodeStructure.collapsable||tree.CONFIG.node.collapsable),this.collapsed=nodeStructure.collapsed,this.text=nodeStructure.text,this.nodeInnerHTML=nodeStructure.innerHTML,this.nodeHTMLclass=(tree.CONFIG.node.HTMLclass?tree.CONFIG.node.HTMLclass:"")+(nodeStructure.HTMLclass?" "+nodeStructure.HTMLclass:""),this.nodeHTMLid=nodeStructure.HTMLid,this.children=[],this},getTree:function(){return TreeStore.get(this.treeId)},getTreeConfig:function(){return this.getTree().CONFIG},getTreeNodeDb:function(){return this.getTree().getNodeDb()},lookupNode:function(nodeId){return this.getTreeNodeDb().get(nodeId)},Tree:function(){return TreeStore.get(this.treeId)},dbGet:function(nodeId){return this.getTreeNodeDb().get(nodeId)},size:function(){var orientation=this.getTreeConfig().rootOrientation;return this.pseudo?-this.getTreeConfig().subTeeSeparation:"NORTH"===orientation||"SOUTH"===orientation?this.width:"WEST"===orientation||"EAST"===orientation?this.height:void 0},childrenCount:function(){return this.collapsed||!this.children?0:this.children.length},childAt:function(index){return this.dbGet(this.children[index])},firstChild:function(){return this.childAt(0)},lastChild:function(){return this.childAt(this.children.length-1)},parent:function(){return this.lookupNode(this.parentId)},leftNeighbor:function(){if(this.leftNeighborId)return this.lookupNode(this.leftNeighborId)},rightNeighbor:function(){if(this.rightNeighborId)return this.lookupNode(this.rightNeighborId)},leftSibling:function(){var leftNeighbor=this.leftNeighbor();if(leftNeighbor&&leftNeighbor.parentId===this.parentId)return leftNeighbor},rightSibling:function(){var rightNeighbor=this.rightNeighbor();if(rightNeighbor&&rightNeighbor.parentId===this.parentId)return rightNeighbor},childrenCenter:function(){var first=this.firstChild(),last=this.lastChild();return first.prelim+(last.prelim-first.prelim+last.size())/2},collapsedParent:function(){var parent=this.parent();return!!parent&&(parent.collapsed?parent:parent.collapsedParent())},leftMost:function(level,depth){if(level>=depth)return this;if(0!==this.childrenCount())for(var i=0,n=this.childrenCount();i<n;i++){var leftmostDescendant=this.childAt(i).leftMost(level+1,depth);if(leftmostDescendant)return leftmostDescendant}},connectorPoint:function(startPoint){var orient=this.Tree().CONFIG.rootOrientation,point={};return this.stackParentId&&("NORTH"===orient||"SOUTH"===orient?orient="WEST":"EAST"!==orient&&"WEST"!==orient||(orient="NORTH")),"NORTH"===orient?(point.x=this.pseudo?this.X-this.Tree().CONFIG.subTeeSeparation/2:this.X+this.width/2,point.y=startPoint?this.Y+this.height:this.Y):"SOUTH"===orient?(point.x=this.pseudo?this.X-this.Tree().CONFIG.subTeeSeparation/2:this.X+this.width/2,point.y=startPoint?this.Y:this.Y+this.height):"EAST"===orient?(point.x=startPoint?this.X:this.X+this.width,point.y=this.pseudo?this.Y-this.Tree().CONFIG.subTeeSeparation/2:this.Y+this.height/2):"WEST"===orient&&(point.x=startPoint?this.X+this.width:this.X,point.y=this.pseudo?this.Y-this.Tree().CONFIG.subTeeSeparation/2:this.Y+this.height/2),point},pathStringThrough:function(){var startPoint=this.connectorPoint(!0),endPoint=this.connectorPoint(!1);return["M",startPoint.x+","+startPoint.y,"L",endPoint.x+","+endPoint.y].join(" ")},drawLineThroughMe:function(hidePoint){var pathString=hidePoint?this.Tree().getPointPathString(hidePoint):this.pathStringThrough();this.lineThroughMe=this.lineThroughMe||this.Tree()._R.path(pathString);var line_style=UTIL.cloneObj(this.connStyle.style);delete line_style["arrow-start"],delete line_style["arrow-end"],this.lineThroughMe.attr(line_style),hidePoint&&(this.lineThroughMe.hide(),this.lineThroughMe.hidden=!0)},addSwitchEvent:function(nodeSwitch){var self=this;UTIL.addEvent(nodeSwitch,"click",function(e){if(e.preventDefault(),!1===self.getTreeConfig().callback.onBeforeClickCollapseSwitch.apply(self,[nodeSwitch,e]))return!1;self.toggleCollapse(),self.getTreeConfig().callback.onAfterClickCollapseSwitch.apply(self,[nodeSwitch,e])})},collapse:function(){return this.collapsed||this.toggleCollapse(),this},expand:function(){return this.collapsed&&this.toggleCollapse(),this},toggleCollapse:function(){var oTree=this.getTree();if(!oTree.inAnimation){oTree.inAnimation=!0,this.collapsed=!this.collapsed,UTIL.toggleClass(this.nodeDOM,"collapsed",this.collapsed),oTree.positionTree();var self=this;setTimeout(function(){oTree.inAnimation=!1,oTree.CONFIG.callback.onToggleCollapseFinished.apply(oTree,[self,self.collapsed])},oTree.CONFIG.animation.nodeSpeed>oTree.CONFIG.animation.connectorsSpeed?oTree.CONFIG.animation.nodeSpeed:oTree.CONFIG.animation.connectorsSpeed)}return this},hide:function(collapse_to_point){collapse_to_point=collapse_to_point||!1;var bCurrentState=this.hidden;this.hidden=!0,this.nodeDOM.style.overflow="hidden";var tree=this.getTree(),config=this.getTreeConfig(),oNewState={opacity:0};if(collapse_to_point&&(oNewState.left=collapse_to_point.x,oNewState.top=collapse_to_point.y),!this.positioned||bCurrentState?(this.nodeDOM.style.visibility="hidden",$?$(this.nodeDOM).css(oNewState):(this.nodeDOM.style.left=oNewState.left+"px",this.nodeDOM.style.top=oNewState.top+"px"),this.positioned=!0):$?$(this.nodeDOM).animate(oNewState,config.animation.nodeSpeed,config.animation.nodeAnimation,function(){this.style.visibility="hidden"}):(this.nodeDOM.style.transition="all "+config.animation.nodeSpeed+"ms ease",this.nodeDOM.style.transitionProperty="opacity, left, top",this.nodeDOM.style.opacity=oNewState.opacity,this.nodeDOM.style.left=oNewState.left+"px",this.nodeDOM.style.top=oNewState.top+"px",this.nodeDOM.style.visibility="hidden"),this.lineThroughMe){var new_path=tree.getPointPathString(collapse_to_point);bCurrentState?this.lineThroughMe.attr({path:new_path}):tree.animatePath(this.lineThroughMe,tree.getPointPathString(collapse_to_point))}return this},hideConnector:function(){var oTree=this.Tree(),oPath=oTree.connectionStore[this.id];return oPath&&oPath.animate({opacity:0},oTree.CONFIG.animation.connectorsSpeed,oTree.CONFIG.animation.connectorsAnimation),this},show:function(){this.hidden;this.hidden=!1,this.nodeDOM.style.visibility="visible";this.Tree();var oNewState={left:this.X,top:this.Y,opacity:1},config=this.getTreeConfig();return $?$(this.nodeDOM).animate(oNewState,config.animation.nodeSpeed,config.animation.nodeAnimation,function(){this.style.overflow=""}):(this.nodeDOM.style.transition="all "+config.animation.nodeSpeed+"ms ease",this.nodeDOM.style.transitionProperty="opacity, left, top",this.nodeDOM.style.left=oNewState.left+"px",this.nodeDOM.style.top=oNewState.top+"px",this.nodeDOM.style.opacity=oNewState.opacity,this.nodeDOM.style.overflow=""),this.lineThroughMe&&this.getTree().animatePath(this.lineThroughMe,this.pathStringThrough()),this},showConnector:function(){var oTree=this.Tree(),oPath=oTree.connectionStore[this.id];return oPath&&oPath.animate({opacity:1},oTree.CONFIG.animation.connectorsSpeed,oTree.CONFIG.animation.connectorsAnimation),this}},TreeNode.prototype.buildNodeFromText=function(node){if(this.image&&(image=document.createElement("img"),image.src=this.image,node.appendChild(image)),this.text)for(var key in this.text)if(key.startsWith("data-"))node.setAttribute(key,this.text[key]);else{var textElement=document.createElement(this.text[key].href?"a":"p");this.text[key].href&&(textElement.href=this.text[key].href,this.text[key].target&&(textElement.target=this.text[key].target)),textElement.className="node-"+key,textElement.appendChild(document.createTextNode(this.text[key].val?this.text[key].val:this.text[key]instanceof Object?"'val' param missing!":this.text[key])),node.appendChild(textElement)}return node},TreeNode.prototype.buildNodeFromHtml=function(node){if("#"===this.nodeInnerHTML.charAt(0)){var elem=document.getElementById(this.nodeInnerHTML.substring(1));elem?((node=elem.cloneNode(!0)).id+="-clone",node.className+=" node"):node.innerHTML="<b> Wrong ID selector </b>"}else node.innerHTML=this.nodeInnerHTML;return node},TreeNode.prototype.createGeometry=function(tree){if(0===this.id&&tree.CONFIG.hideRootNode)return this.width=0,void(this.height=0);var drawArea=tree.drawArea,node=document.createElement(this.link.href?"a":"div");node.className=this.pseudo?"pseudo":TreeNode.CONFIG.nodeHTMLclass,this.nodeHTMLclass&&!this.pseudo&&(node.className+=" "+this.nodeHTMLclass),this.nodeHTMLid&&(node.id=this.nodeHTMLid),this.link.href&&(node.href=this.link.href,node.target=this.link.target),$?$(node).data("treenode",this):node.data={treenode:this},this.pseudo||(node=this.nodeInnerHTML?this.buildNodeFromHtml(node):this.buildNodeFromText(node),(this.collapsed||this.collapsable&&this.childrenCount()&&!this.stackParentId)&&this.createSwitchGeometry(tree,node)),tree.CONFIG.callback.onCreateNode.apply(tree,[this,node]),drawArea.appendChild(node),this.width=node.offsetWidth,this.height=node.offsetHeight,this.nodeDOM=node,tree.imageLoader.processNode(this)},TreeNode.prototype.createSwitchGeometry=function(tree,nodeEl){nodeEl=nodeEl||this.nodeDOM;var nodeSwitchEl=UTIL.findEl(".collapse-switch",!0,nodeEl);return nodeSwitchEl||((nodeSwitchEl=document.createElement("a")).className="collapse-switch",nodeEl.appendChild(nodeSwitchEl),this.addSwitchEvent(nodeSwitchEl),this.collapsed&&(nodeEl.className+=" collapsed"),tree.CONFIG.callback.onCreateNodeCollapseSwitch.apply(tree,[this,nodeEl,nodeSwitchEl])),nodeSwitchEl},Tree.CONFIG={maxDepth:100,rootOrientation:"NORTH",nodeAlign:"CENTER",levelSeparation:30,siblingSeparation:30,subTeeSeparation:30,hideRootNode:!1,animateOnInit:!1,animateOnInitDelay:500,padding:15,scrollbar:"native",connectors:{type:"curve",style:{stroke:"black"},stackIndent:15},node:{link:{target:"_self"}},animation:{nodeSpeed:450,nodeAnimation:"linear",connectorsSpeed:450,connectorsAnimation:"linear"},callback:{onCreateNode:function(treeNode,treeNodeDom){},onCreateNodeCollapseSwitch:function(treeNode,treeNodeDom,switchDom){},onAfterAddNode:function(newTreeNode,parentTreeNode,nodeStructure){},onBeforeAddNode:function(parentTreeNode,nodeStructure){},onAfterPositionNode:function(treeNode,nodeDbIndex,containerCenter,treeCenter){},onBeforePositionNode:function(treeNode,nodeDbIndex,containerCenter,treeCenter){},onToggleCollapseFinished:function(treeNode,bIsCollapsed){},onAfterClickCollapseSwitch:function(nodeSwitch,event){},onBeforeClickCollapseSwitch:function(nodeSwitch,event){},onTreeLoaded:function(rootTreeNode){}}},TreeNode.CONFIG={nodeHTMLclass:"node"};var i,JSONconfig={make:function(configArray){var node,i=configArray.length;for(this.jsonStructure={chart:null,nodeStructure:null};i--;)(node=configArray[i]).hasOwnProperty("container")?this.jsonStructure.chart=node:node.hasOwnProperty("parent")||node.hasOwnProperty("container")||(this.jsonStructure.nodeStructure=node,node._json_id=0);return this.findChildren(configArray),this.jsonStructure},findChildren:function(nodes){for(var parents=[0];parents.length;){for(var parentId=parents.pop(),parent=this.findNode(this.jsonStructure.nodeStructure,parentId),i=0,len=nodes.length,children=[];i<len;i++){var node=nodes[i];node.parent&&node.parent._json_id===parentId&&(node._json_id=this.getID(),delete node.parent,children.push(node),parents.push(node._json_id))}children.length&&(parent.children=children)}},findNode:function(node,nodeId){var childrenLen,found;if(node._json_id===nodeId)return node;if(node.children)for(childrenLen=node.children.length;childrenLen--;)if(found=this.findNode(node.children[childrenLen],nodeId))return found},getID:(i=1,function(){return i++})},Treant=function(jsonConfig,callback,jQuery){jsonConfig instanceof Array&&(jsonConfig=JSONconfig.make(jsonConfig)),jQuery&&($=jQuery),this.tree=TreeStore.createTree(jsonConfig),this.tree.positionTree(callback)};Treant.prototype.destroy=function(){TreeStore.destroy(this.tree.id)},window.Treant=Treant}();