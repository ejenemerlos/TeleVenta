

BEGIN TRY

MERGE INTO [Security_Navigation_Nodes_Roles] AS Target
USING (VALUES
  (N'A5754908-A03E-4AAB-9599-1349B27C3264',N'Cliente',0,1)
 ,(N'A5754908-A03E-4AAB-9599-1349B27C3264',N'notRegistered',0,1)
 ,(N'A5754908-A03E-4AAB-9599-1349B27C3264',N'Ruta',0,1)
 ,(N'A5754908-A03E-4AAB-9599-1349B27C3264',N'Supervisor',0,1)
 ,(N'A5754908-A03E-4AAB-9599-1349B27C3264',N'TeleVenta',0,1)
 ,(N'A5754908-A03E-4AAB-9599-1349B27C3264',N'users',0,1)
 ,(N'A5754908-A03E-4AAB-9599-1349B27C3264',N'Vendedor',0,1)
 ,(N'9A816DE2-430A-436B-B7F1-145F90BF016B',N'Vendedor',0,1)
 ,(N'54066E2E-9EED-444E-A0AE-1E9D18E7E941',N'AdminPortal',0,1)
 ,(N'54066E2E-9EED-444E-A0AE-1E9D18E7E941',N'admins',1,1)
 ,(N'54066E2E-9EED-444E-A0AE-1E9D18E7E941',N'Cliente',0,1)
 ,(N'54066E2E-9EED-444E-A0AE-1E9D18E7E941',N'Ruta',0,1)
 ,(N'54066E2E-9EED-444E-A0AE-1E9D18E7E941',N'Supervisor',0,1)
 ,(N'54066E2E-9EED-444E-A0AE-1E9D18E7E941',N'TeleVenta',0,1)
 ,(N'54066E2E-9EED-444E-A0AE-1E9D18E7E941',N'Vendedor',0,1)
 ,(N'3468C35B-9A5A-4F9E-9E03-2D6A1CBED087',N'Cliente',0,1)
 ,(N'3468C35B-9A5A-4F9E-9E03-2D6A1CBED087',N'TeleVenta',0,1)
 ,(N'3468C35B-9A5A-4F9E-9E03-2D6A1CBED087',N'Vendedor',0,1)
 ,(N'B87F546F-2907-4B51-9DAF-3AA9402D89E9',N'Vendedor',0,1)
) AS Source ([NodeId],[RoleId],[CanView],[OriginId])
ON (Target.[NodeId] = Source.[NodeId] AND Target.[RoleId] = Source.[RoleId])
WHEN MATCHED AND (
	NULLIF(Source.[CanView], Target.[CanView]) IS NOT NULL OR NULLIF(Target.[CanView], Source.[CanView]) IS NOT NULL OR 
	NULLIF(Source.[OriginId], Target.[OriginId]) IS NOT NULL OR NULLIF(Target.[OriginId], Source.[OriginId]) IS NOT NULL) THEN
 UPDATE SET
  [CanView] = Source.[CanView], 
  [OriginId] = Source.[OriginId]
WHEN NOT MATCHED BY TARGET THEN
 INSERT([NodeId],[RoleId],[CanView],[OriginId])
 VALUES(Source.[NodeId],Source.[RoleId],Source.[CanView],Source.[OriginId])
WHEN NOT MATCHED BY SOURCE AND TARGET.OriginId = 1 THEN 
 DELETE
;
END TRY
BEGIN CATCH
    DECLARE @ERRORNUMBER	INT,@ERRORMSG		VARCHAR(MAX),@ERRORSTATE		INT
    SELECT @ERRORNUMBER = 50000 + ERROR_NUMBER(),@ERRORMSG = ERROR_MESSAGE(), @ERRORSTATE = ERROR_STATE();
    THROW @ERRORNUMBER, @ERRORMSG, @ERRORSTATE
END CATCH
GO





