!function($){$.fn.areYouSure=function(options){var settings=$.extend({message:"You have unsaved changes!",dirtyClass:"dirty",change:null,silent:!1,addRemoveFieldsMarksDirty:!1,fieldEvents:"change keyup propertychange input",fieldSelector:":input:not(input[type=submit]):not(input[type=button])"},options),getValue=function($field){if($field.hasClass("ays-ignore")||$field.hasClass("aysIgnore")||$field.attr("data-ays-ignore")||void 0===$field.attr("name"))return null;if($field.is(":disabled"))return"ays-disabled";var val,type=$field.attr("type");switch($field.is("select")&&(type="select"),type){case"checkbox":case"radio":val=$field.is(":checked");break;case"select":val="",$field.find("option").each(function(o){var $option=$(this);$option.is(":selected")&&(val+=$option.val())});break;default:val=$field.val()}return val},storeOrigValue=function($field){$field.data("ays-orig",getValue($field))},checkForm=function(evt){var isFieldDirty=function($field){var origValue=$field.data("ays-orig");return void 0!==origValue&&getValue($field)!=origValue},$form=$(this).is("form")||$(this).is(".form")?$(this):$(this).parents("form").length>0?$(this).parents("form"):$(this).parents(".form");if(isFieldDirty($(evt.target)))setDirtyStatus($form,!0);else{if($fields=$form.find(settings.fieldSelector),settings.addRemoveFieldsMarksDirty)if($form.data("ays-orig-field-count")!=$fields.length)return void setDirtyStatus($form,!0);var isDirty=!1;$fields.each(function(){if($field=$(this),isFieldDirty($field))return isDirty=!0,!1}),setDirtyStatus($form,isDirty)}},initForm=function($form){var fields=$form.find(settings.fieldSelector);$(fields).each(function(){storeOrigValue($(this))}),$(fields).unbind(settings.fieldEvents,checkForm),$(fields).bind(settings.fieldEvents,checkForm),$form.data("ays-orig-field-count",$(fields).length),setDirtyStatus($form,!1)},setDirtyStatus=function($form,isDirty){var changed=isDirty!=$form.hasClass(settings.dirtyClass);$form.toggleClass(settings.dirtyClass,isDirty),changed&&(settings.change&&settings.change.call($form,$form),isDirty&&$form.trigger("dirty.areYouSure",[$form]),isDirty||$form.trigger("clean.areYouSure",[$form]),$form.trigger("change.areYouSure",[$form]))},rescan=function(){var $form=$(this),fields=$form.find(settings.fieldSelector);$(fields).each(function(){var $field=$(this);$field.data("ays-orig")||(storeOrigValue($field),$field.bind(settings.fieldEvents,checkForm))}),$form.trigger("checkform.areYouSure")},reinitialize=function(){initForm($(this))};return settings.silent||window.aysUnloadSet||(window.aysUnloadSet=!0,$(window).bind("beforeunload",function(){if($dirtyForms=$("form, .form").filter("."+settings.dirtyClass),0!=$dirtyForms.length){if(navigator.userAgent.toLowerCase().match(/msie|chrome/)){if(window.aysHasPrompted)return;window.aysHasPrompted=!0,window.setTimeout(function(){window.aysHasPrompted=!1},900)}return settings.message}})),this.each(function(elem){if($(this).is("form, .form")){var $form=$(this);$form.submit(function(){$form.removeClass(settings.dirtyClass)}),$form.bind("reset",function(){setDirtyStatus($form,!1)}),$form.bind("rescan.areYouSure",rescan),$form.bind("reinitialize.areYouSure",reinitialize),$form.bind("checkform.areYouSure",checkForm),initForm($form)}})}}(jQuery);